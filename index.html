<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Интерактивная карта Екатеринбурга</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    h1 { text-align: center; margin: 10px; }
    #map { width: 100%; height: 85vh; }
  </style>
</head>

<body>

<h1>Интерактивная карта городских объектов</h1>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([56.8389, 60.6057], 12);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  function loadLayer(file, color, name) {
    return fetch(file)
      .then(r => r.json())
      .then(data => {
        const layer = L.geoJSON(data, {
          pointToLayer: (f, latlng) =>
            L.circleMarker(latlng, {
              radius: 6,
              fillColor: color,
              color: '#000',
              weight: 1,
              fillOpacity: 0.8
            }),
          onEachFeature: (f, l) => {
            const p = f.properties || {};
            l.bindPopup(
              `<b>${p.name || ''}</b><br>
               ${p.type || ''}<br>
               ${p.description || ''}`
            );
          }
        }).addTo(map);
        return { name, layer };
      });
  }

  Promise.all([
    loadLayer('education.geojson', '#1f78b4', 'Учебные корпуса'),
    loadLayer('sports.geojson', '#33a02c', 'Спортивные сооружения'),
    loadLayer('stops.geojson', '#e31a1c', 'Остановки'),
    loadLayer('interesting_places.geojson', '#ff7f00', 'Интересные места')
  ]).then(layers => {
    const overlays = {};
    let bounds;

    layers.forEach(l => {
      overlays[l.name] = l.layer;
      bounds = bounds ? bounds.extend(l.layer.getBounds()) : l.layer.getBounds();
    });

    L.control.layers(null, overlays).addTo(map);
    if (bounds?.isValid()) map.fitBounds(bounds, { padding: [20,20] });
  });
</script>

</body>
</html>
